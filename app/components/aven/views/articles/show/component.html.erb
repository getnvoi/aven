<%= ui("page", title: article.title) do |page| %>
  <% page.with_actions_area do %>
    <%= ui("button", label: "Edit", href: routes.edit_article_path(article), variant: :outline) %>
    <%= button_to "Delete",
        routes.article_path(article),
        method: :delete,
        form: { data: { turbo_confirm: "Are you sure you want to delete this article?" } },
        class: "inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 py-2 border border-red-300 text-red-700 bg-white hover:bg-red-50" %>
    <%= ui("button", label: "Back to Articles", href: routes.articles_path, variant: :outline) %>
  <% end %>

  <div class="max-w-4xl space-y-8">
    <%# Status and metadata %>
    <div class="flex items-center gap-4 text-sm text-gray-500">
      <% badge = status_badge %>
      <%= ui("badge", label: badge[:label], variant: badge[:variant]) %>

      <% if article.author %>
        <span>By <%= article.author.name %></span>
      <% end %>

      <% if article.published_at %>
        <span><%= format_date(article.published_at) %></span>
      <% end %>
    </div>

    <%# Tags %>
    <% if article.tag_list.any? %>
      <div class="flex flex-wrap gap-2">
        <% article.tag_list.each do |tag| %>
          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
            <%= tag %>
          </span>
        <% end %>
      </div>
    <% end %>

    <%# Main visual %>
    <% if article.main_visual.attached? %>
      <div class="rounded-lg overflow-hidden">
        <%= image_tag article.main_visual, class: "w-full h-auto" %>
      </div>
    <% end %>

    <%# Introduction %>
    <% if article.intro.present? %>
      <div class="text-xl text-gray-600 leading-relaxed border-l-4 border-blue-500 pl-4">
        <%= article.intro %>
      </div>
    <% end %>

    <%# Content %>
    <% if article.description.present? %>
      <div class="prose prose-lg max-w-none">
        <%= rendered_description %>
      </div>
    <% end %>

    <%# Attachments %>
    <% if article.article_attachments.any? %>
      <div class="border-t pt-8">
        <h3 class="text-lg font-semibold mb-4">Attachments</h3>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
          <% article.sorted_attachments.each do |attachment| %>
            <% if attachment.file.attached? %>
              <div class="relative group">
                <% if attachment.file.image? %>
                  <%= link_to url_for(attachment.file), target: "_blank", class: "block" do %>
                    <%= image_tag attachment.file.variant(resize_to_limit: [200, 200]),
                        class: "w-full h-32 object-cover rounded-lg" %>
                  <% end %>
                <% else %>
                  <%= link_to url_for(attachment.file), target: "_blank",
                      class: "flex items-center justify-center w-full h-32 bg-gray-100 rounded-lg hover:bg-gray-200" do %>
                    <div class="text-center">
                      <svg class="mx-auto h-8 w-8 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                      </svg>
                      <span class="text-xs text-gray-500 mt-1 block truncate px-2">
                        <%= attachment.file.filename %>
                      </span>
                    </div>
                  <% end %>
                <% end %>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>

    <%# Related articles %>
    <% if article.related_articles.any? %>
      <div class="border-t pt-8">
        <h3 class="text-lg font-semibold mb-4">Related Articles</h3>
        <div class="grid gap-4">
          <% article.related_articles.each do |related| %>
            <%= link_to routes.article_path(related),
                class: "block p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition" do %>
              <h4 class="font-medium text-gray-900"><%= related.title %></h4>
              <% if related.intro.present? %>
                <p class="text-sm text-gray-500 mt-1 line-clamp-2"><%= related.intro %></p>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
